<&| /includes/partners.html &></&>
<%perl>

##
## MASTER SITEMAP FUNCTION:
##
## this function goes through top level directories and creates an array of all pages on the site.
##	this array should be suitable for a google sitemap submission, OR the /sitemap/index.html page.
##
## two dimensional data structure
##
## array of hashrefs.
##		each hashref contains href=>"" and title=>"" as well as pages=>[]
##	pages=>[] is an array of more page hashrefs.
##
## this is a function so that *EVENTUALLY* it can include dynamic content.
##
## NOTE: there is *zero* formatting in this output, that is your job.
##

sub build_sitemap {
	my (%filter) = @_;

	my @PAGES = ();
	push @PAGES, { href=>"/", title=>"Home", 
		pages=>[
			{ href=>"https://www.zoovy.com/register/", title=>"Register for a free evaluation" },
			{ href=>"/recover/", title=>"Password recovery" },
			{ href=>"https://www.zoovy.com/login/", title=>"Secure login" },
			]
		};
	
	push @PAGES, { href=>"/howitworks/", title=>"Product", 
		pages=>[
			{ href=>'/howitworks/index.html', title=>"Overview" },
			{ href=>'/complete/index.html', title=>"Zoovy Complete" },
			{ href=>'/howitworks/multiple_online_stores.html', title=>"Web stores" },
			{ href=>'/howitworks/inventory_control.html', title=>"Inventory management" },
			{ href=>'/howitworks/accounting.html', title=>"Accounting" },
			{ href=>'/howitworks/order-processing.html', title=>"Order processing" },
			{ href=>'/howitworks/shipping_tracking.html', title=>"Shipping" },
#			{ href=>'/howitworks/syndication.html', title=>"Getting products seen" },
			{ href=>'/howitworks/wholesale.html', title=>"Wholesale" },
			]
		};

	push @PAGES, { href=>"/services", title=>"Services", 
		pages=>[
			{ href=>'/howitworks/design/index.html', title=>"Design services" },
			{ href=>'/howitworks/marketing/index.html', title=>"Marketing &amp; retention" },
			{ href=>'/services/comparison-shopping-sites.html', title=>"Comparison shopping" },
			{ href=>'/services/domain-registration.html', title=>"Domain registration" },
			{ href=>'/services/hosting.html', title=>"Hosting" },
			{ href=>'/services/live-training-and-tech-support.html', title=>"Live training &amp; technical support" },
			{ href=>'/services/marketplaces.html', title=>"Marketplaces" },

## these pages were designed for landing pages for both organic and paid clicks. keyword rich. very targeted.
## they should be in the sitemap so they get crawled.

			{ href=>'/the-best-service-provider-for/balancing-privacy-and-marketing', title=>"Customer Retention (CRM)" },
			{ href=>'/the-best-service-provider-for/customized-shopping-experience', title=>"Customized shopping experience" },
			{ href=>'/the-best-service-provider-for/iphone-mobile-web-stores/', title=>"Mobile storefront" },
			{ href=>'/the-best-service-provider-for/web-store-design-that-sells', title=>"Web design that sells" },
			{ href=>'/the-best-service-provider-for/web-store-personalization/', title=>"Storefront personalization" },
			{ href=>'/stability/index.html', title=>"Stability" },
			]
		};


	## NOTE: eventually this will automatically build the list of partners.
	#opendir $D, "/httpd/htdocs/compatible-integration-review/";
	#while (readdir($D)) {
	#	}
	#closedir $D;
	
	## the get_partners function comes from /include/partners.html
	my @PARTNERS = &get_partners(active=>1);


	push @PAGES, { href=>'/compatible-integration-review/', title=>"Partners",
		pages=>\@PARTNERS 
		};

	push @PAGES, { href=>"/company/", title=>"Company Information", 
		pages=>[
			{ href=>'/company/', title=>"About Zoovy" },
			{ href=>'/company/case_studies', title=>"Case Studies" },
			{ href=>'/company/contact', title=>"Contact" },
			{ href=>'/contact', title=>"Contact Zoovy Electronically" },
			{ href=>'/company/employment', title=>"Employment" },
			{ href=>'/company/logo', title=>"Logo" },
			{ href=>'/company/management', title=>"Management" },
			{ href=>'/company/news', title=>"In the News" },
			{ href=>'/company/pressreleases', title=>"Press Releases" },
			{ href=>'/company/testimonials', title=>"Testimonials" },
			]
		};

	push @PAGES, { href=>"/legal/", title=>"Legal",
		pages=>[
			{ href=>'/legal/binary/', title=>"Software License" },
			{ href=>'/legal/copyright/', title=>"Copyright" },
			{ href=>'/legal/privacy/', title=>"Privacy" },
			{ href=>'/legal/terms/', title=>"Terms of Service" }, ## /legal/tos looks like a symlink with this.
			]
		};

	return(\@PAGES);
	};


##
## this parameter is passed by the /httpd/htdocs/sitemap.pl commmand it
##	outputs url tags suitable for the sitemap.xml file.
##
if ($ARGS{'xml'}>0) {
	my $pages = &build_sitemap();
	foreach my $level1 (@{$pages}) {
		next if ($level1->{'href'} eq '/');
		$level1->{'title'} =~ s/[\s\_]/+/gs;
		print qq~<url><loc>http://www.zoovy.com$level1->{'href'}?title=$level1->{'title'}</loc></url>\n~;
		if ((defined $level1->{'pages'}) && (ref($level1->{'pages'}) eq 'ARRAY')) {
			foreach my $level2 (@{$level1->{'pages'}}) {
				next if ($level2->{'href'} eq '');
				next if ($level2->{'href'} =~ /^http[s]?\:\/\//);
				$level2->{'title'} =~ s/[\s\_]/+/gs;
				print qq~<url><loc>http://www.zoovy.com$level2->{'href'}?title=$level2->{'title'}</loc></url>\n~;
				## if we ever need a level 3.. it would go here.
				}
			}	
		}
	}

</%perl>

