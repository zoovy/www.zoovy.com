#!/usr/bin/perl

use lib '/httpd/modules';
use INVENTORY;
use ZSKU;
use POGS;

my $code = '';

# print "Content-type: text/html\n\n";

use CGI;
use GTOOLS;
use ZOOVY;
use strict;
use PRODUCT::BUYME;

my ($USERNAME,$FLAGS,$MID,$LUSER,$RESELLER) = ZOOVY::authenticate("/biz/setup",2,'_P&2');
if ($USERNAME eq '') { exit; }

if ($FLAGS =~ /,PKG=SHOPCART,/) { $FLAGS .= ',WEB,'; }
if ($FLAGS =~ /,L1,/) { if ($FLAGS =~ /,DEV,/) { $FLAGS .= ',WEB,'; } }

if ($FLAGS !~ /,WEB,/) {
	&GTOOLS::print_form('','deny-buybutton.shtml',1);	
	exit;
	}


my $cgi = new CGI;

my $product_id = $cgi->param('product');
if (not defined $product_id) { $product_id = ''; }
my $img = '';

($code,$img) = &PRODUCT::BUYME::buymebutton($USERNAME,$product_id,$cgi->param('img'));

$GTOOLS::TAG{'<!-- PRODUCT -->'} = $product_id;
$GTOOLS::TAG{'<!-- CODE -->'} = &ZOOVY::incode($code);
$GTOOLS::TAG{'<!-- BUTTON -->'} = $code;
$GTOOLS::TAG{'<!-- IMG -->'} = $img;

&GTOOLS::output(file=>'buybutton.shtml',header=>1);
